<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Подсчет прожитых недель/месяцев/лет</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .circle {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin: 2px;
      vertical-align: middle;
    }
    .year-row {
      margin-bottom: 5px;
    }
    #percent-info {
      font-weight: bold;
      margin: 10px 0;
    }
    #controls {
      margin-bottom: 20px;
    }
    .important-event {
      margin-bottom: 5px;
    }
    .important-event label {
      display: inline-block;
      width: 120px;
    }
  </style>
</head>
<body>
  <h1>Подсчет прожитого времени</h1>
  
  <div id="controls">
    <div>
      <label for="birthdate">Дата рождения:</label>
      <input type="date" id="birthdate">
    </div>
    
    <div style="margin-top:10px;">
      <span>Отображать в:</span>
      <label><input type="radio" name="timeframe" value="week" checked> Неделях</label>
      <label><input type="radio" name="timeframe" value="month"> Месяцах</label>
      <label><input type="radio" name="timeframe" value="year"> Годах</label>
    </div>
    
    <h3>Важные даты (до 10 штук):</h3>
    <div id="importantDates">
      <!-- Пример заготовленных полей: -->
      <div class="important-event">
        <label>Дата 1:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#FF0000">
      </div>
      <div class="important-event">
        <label>Дата 2:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#0000FF">
      </div>
      <div class="important-event">
        <label>Дата 3:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#008000">
      </div>
      <div class="important-event">
        <label>Дата 4:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#FF00FF">
      </div>
      <div class="important-event">
        <label>Дата 5:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#FFA500">
      </div>
      <div class="important-event">
        <label>Дата 6:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#808000">
      </div>
      <div class="important-event">
        <label>Дата 7:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#800080">
      </div>
      <div class="important-event">
        <label>Дата 8:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#00FFFF">
      </div>
      <div class="important-event">
        <label>Дата 9:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#A52A2A">
      </div>
      <div class="important-event">
        <label>Дата 10:</label>
        <input type="date" class="important-date">
        <input type="color" class="important-color" value="#000000">
      </div>
    </div>
    
    <button style="margin-top:10px;" onclick="calculate()">Показать результат</button>
  </div>
  
  <!-- Блок для процентов (расположим его над сеткой) -->
  <div id="percent-info"></div>
  
  <!-- Основной блок для вывода таблицы кружочков -->
  <div id="result"></div>
  
  <script>
    // Функция разницы в годах (учитываем месяц и день, чтобы не завысить возраст на неполный год)
    function getYearDiff(date1, date2) {
      let diff = date2.getFullYear() - date1.getFullYear();
      // проверяем, не "полный" ли год: если месяц/день еще не наступили, вычитаем 1
      if (
        date2.getMonth() < date1.getMonth() ||
        (date2.getMonth() === date1.getMonth() && date2.getDate() < date1.getDate())
      ) {
        diff--;
      }
      return diff;
    }

    // Функция разницы в месяцах
    // Возвращает число полных месяцев между date1 и date2
    function getMonthDiff(date1, date2) {
      let years = date2.getFullYear() - date1.getFullYear();
      let months = years * 12 + (date2.getMonth() - date1.getMonth());
      // Проверяем, не нужно ли вычесть неполный месяц
      if (date2.getDate() < date1.getDate()) {
        months--;
      }
      return months;
    }

    // Функция разницы в неделях
    function getWeekDiff(date1, date2) {
      const oneWeek = 1000 * 60 * 60 * 24 * 7;
      return Math.floor((date2 - date1) / oneWeek);
    }

    function calculate() {
      const birthDateInput = document.getElementById('birthdate').value;
      if (!birthDateInput) {
        alert('Пожалуйста, введите дату рождения.');
        return;
      }
      
      const birthDate = new Date(birthDateInput);
      const today = new Date();
      if (birthDate > today) {
        alert('Дата рождения не может быть в будущем!');
        return;
      }
      
      // Определяем, какой таймфрейм выбран (week, month, year)
      const timeframe = document.querySelector('input[name="timeframe"]:checked').value;
      
      // Считаем, сколько "интервалов" человек уже прожил
      let livedIntervals = 0;
      let intervalsPerYear = 52; // По умолчанию для week
      let totalIntervals = 80 * 52; // По умолчанию для 80 лет (неделями)

      if (timeframe === 'week') {
        livedIntervals = getWeekDiff(birthDate, today);
        intervalsPerYear = 52;
        totalIntervals = 80 * 52;
      } else if (timeframe === 'month') {
        livedIntervals = getMonthDiff(birthDate, today);
        intervalsPerYear = 12;
        totalIntervals = 80 * 12;
      } else if (timeframe === 'year') {
        livedIntervals = getYearDiff(birthDate, today);
        intervalsPerYear = 1;
        totalIntervals = 80; 
      }

      // Для расчета процентов: если превышает 80 лет, "зажимаем" на 100%
      let livedPercent = (livedIntervals / totalIntervals) * 100;
      if (livedPercent > 100) livedPercent = 100;
      let remainPercent = 100 - livedPercent;
      
      livedPercent = livedPercent.toFixed(2);
      remainPercent = remainPercent.toFixed(2);

      // Считываем важные даты и цвета
      // Для каждой важной даты считаем её "номер интервала" и запоминаем в объекте
      const importantDateInputs = document.querySelectorAll('.important-date');
      const importantColorInputs = document.querySelectorAll('.important-color');
      let specialMap = {}; 
      // ключ: номер интервала, значение: цвет

      for (let i = 0; i < importantDateInputs.length; i++) {
        const d = importantDateInputs[i].value;
        if (!d) continue; // если дата не выбрана, пропускаем

        const color = importantColorInputs[i].value || '#000000';
        const specialDate = new Date(d);

        // Вычисляем, в какой интервал попадает эта дата
        let index = 0;
        if (timeframe === 'week') {
          index = getWeekDiff(birthDate, specialDate);
        } else if (timeframe === 'month') {
          index = getMonthDiff(birthDate, specialDate);
        } else {
          index = getYearDiff(birthDate, specialDate);
        }

        // Проверяем, что индекс в допустимом диапазоне [0..(totalIntervals-1)]
        if (index >= 0 && index < totalIntervals) {
          // Если несколько дат попадают в один интервал — возьмём последнюю
          specialMap[index] = color;
        }
      }

      // Очищаем предыдущий вывод
      document.getElementById('result').innerHTML = '';

      // Выводим проценты над таблицей
      const percentDiv = document.getElementById('percent-info');
      percentDiv.textContent = `Прожито: ${livedPercent}% | Осталось: ${remainPercent}% (до 80 лет)`;

      // Генерируем 80 строк (от года рождения до +79)
      // В каждой строке будет "intervalsPerYear" кружков (52 нед/12 мес/1 год)
      const resultDiv = document.getElementById('result');
      const startYear = birthDate.getFullYear();
      
      for (let year = 0; year < 80; year++) {
        const yearDiv = document.createElement('div');
        yearDiv.classList.add('year-row');
        
        // Фактический календарный год, который наступает: startYear + year
        const yearLabel = document.createElement('span');
        yearLabel.textContent = `Год ${startYear + year}: `;
        yearLabel.style.display = 'inline-block';
        yearLabel.style.width = '110px';
        yearDiv.appendChild(yearLabel);
        
        for (let w = 0; w < intervalsPerYear; w++) {
          // "Глобальный" индекс среди всех интервалов
          const index = year * intervalsPerYear + w; 
          
          const circle = document.createElement('span');
          circle.classList.add('circle');
          
          // По умолчанию: будущий интервал — светлый
          circle.style.backgroundColor = '#cccccc';
          
          // Если прожит (index < livedIntervals), делаем тёмный
          if (index < livedIntervals) {
            circle.style.backgroundColor = '#333333';
          }
          
          // Проверяем, не является ли это важной датой
          if (specialMap[index]) {
            // Если да, перекрашиваем цветом события
            circle.style.backgroundColor = specialMap[index];
          }
          
          yearDiv.appendChild(circle);
        }
        
        resultDiv.appendChild(yearDiv);
      }
    }
  </script>
</body>
</html>
